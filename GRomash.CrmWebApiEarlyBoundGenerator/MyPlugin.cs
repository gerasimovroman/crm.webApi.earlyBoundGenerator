using System;
using System.ComponentModel.Composition;
using System.IO;
using System.Linq;
using System.Reflection;
using XrmToolBox.Extensibility;
using XrmToolBox.Extensibility.Interfaces;

namespace GRomash.CrmWebApiEarlyBoundGenerator
{
    [Export(typeof(IXrmToolBoxPlugin)),
        ExportMetadata("Name", "Early Bound Generator for Crm Web Api"),
        ExportMetadata("Description", "Tool for generating entities model for Xrm.Tools.CRMWebAPI"),
        // Please specify the base64 content of a 32x32 pixels image
        ExportMetadata("SmallImageBase64", "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"),
        // Please specify the base64 content of a 80x80 pixels image
        ExportMetadata("BigImageBase64", "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"),
        ExportMetadata("BackgroundColor", "Lavender"),
        ExportMetadata("PrimaryFontColor", "Black"),
        ExportMetadata("SecondaryFontColor", "Gray")]
    public class MyPlugin : PluginBase
    {
        /// <summary>
        /// Gets the control.
        /// </summary>
        /// <returns></returns>
        public override IXrmToolBoxPluginControl GetControl()
        {
            return new MyPluginControl();
        }

        /// <summary>
        /// Constructor 
        /// </summary>
        public MyPlugin()
        {
            // If you have external assemblies that you need to load, uncomment the following to 
            // hook into the event that will fire when an Assembly fails to resolve
            AppDomain.CurrentDomain.AssemblyResolve += AssemblyResolveEventHandler;
        }

        /// <summary>
        /// Event fired by CLR when an assembly reference fails to load
        /// Assumes that related assemblies will be loaded from a subfolder named the same as the Plugin
        /// For example, a folder named Sample.XrmToolBox.MyPlugin 
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="args"></param>
        /// <returns></returns>
        private Assembly AssemblyResolveEventHandler(object sender, ResolveEventArgs args)
        {
            Assembly loadAssembly = null;
            var currAssembly = Assembly.GetExecutingAssembly();

            // base name of the assembly that failed to resolve
            var argName = args.Name.Substring(0, args.Name.IndexOf(",", StringComparison.Ordinal));

            // check to see if the failing assembly is one that we reference.
            var refAssemblies = currAssembly.GetReferencedAssemblies().ToList();
            var refAssembly = refAssemblies.FirstOrDefault(a => a.Name == argName);

            if (refAssembly == null)
            {
                // load from the path to this plugin assembly, not host executable
                var dir = Path.GetDirectoryName(currAssembly.Location)?.ToLower();

                var assemblyFilePath = Path.Combine(dir, $"{nameof(GRomash)}\\{argName}.dll");

                if (File.Exists(assemblyFilePath))
                {
                    loadAssembly = Assembly.LoadFrom(assemblyFilePath);
                }
            }

            return loadAssembly;
        }
    }
}